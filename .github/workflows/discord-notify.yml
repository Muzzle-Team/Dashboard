name: Discord Commit Notifier
on:
  push:
    branches:
      - main
jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2
      
      - name: Get Commit Stats
        id: stats
        run: |
          ADDITIONS=$(git show --shortstat | grep -oP '\d+(?= insertion)' || echo "0")
          DELETIONS=$(git show --shortstat | grep -oP '\d+(?= deletion)' || echo "0")
          FILES_CHANGED=$(git show --shortstat | grep -oP '\d+(?= file)' || echo "0")
          echo "additions=$ADDITIONS" >> $GITHUB_OUTPUT
          echo "deletions=$DELETIONS" >> $GITHUB_OUTPUT
          echo "files=$FILES_CHANGED" >> $GITHUB_OUTPUT
      
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: "https://discord.com/api/webhooks/1423632532842348607/uOyYnGnD_JPMvn_fLC15O6A8-kTjnDQZCzTa2Z2fVo9CVMjeDWzfGajoQmv6w73hK0EA"
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -d @- "$DISCORD_WEBHOOK" <<EOF
          {
            "embeds": [{
              "title": "ðŸš€ New Commit",
              "description": "**Repository:** ${{ github.repository }}\n**Commit:** \`${GITHUB_SHA:0:7}\`",
              "url": "${{ github.event.head_commit.url }}",
              "color": 3447003,
              "fields": [
                {
                  "name": "ðŸ“ Message",
                  "value": "$(echo "$COMMIT_MESSAGE" | head -c 200)",
                  "inline": false
                },
                {
                  "name": "ðŸ“Š Changes",
                  "value": "ðŸ“ **${{ steps.stats.outputs.files }}** files\nâœ… **+${{ steps.stats.outputs.additions }}** additions\nâŒ **-${{ steps.stats.outputs.deletions }}** deletions",
                  "inline": true
                }
              ],
              "author": {
                "name": "${{ github.event.head_commit.author.name }}",
                "icon_url": "https://github.com/${{ github.actor }}.png"
                "url": "https://github.com/${{ github.actor }}"
              },
              "thumbnail": {
                "url": "https://cdn.discordapp.com/icons/1294072522219978802/12e48a18d32be277c7b1dc8a87ac00b9.webp?size=256"
              },
              "image": {
                "url": "https://i.ibb.co/HLRKTt6N/9039cf35d299e6afb3a0d8d5e018bcf2.png"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
          }
          EOF
